{"version":3,"sources":["webpack:///./src/pages/index.js","webpack:///./src/images/search-by-route.jpg","webpack:///./src/images/search-nearby.jpg"],"names":["IndexPage","props","_this","_React$Component","call","this","state","autocompleteOptions","autocompleteResults","dataLoaded","locations","componentDidMount","requestLocation","window","scrollTo","setData","loadData","_this2","fetch","then","res","text","rows","uniqBy","split","slice","map","parseRow","filter","r","l","name","latitude","longitude","console","log","length","uniq","city","setState","_this3","navigator","permissions","undefined","options","enableHighAccuracy","timeout","maximumAge","handlePosition","position","coords","_position$coords","reverseGeocode","address","locationA","myLocation","query","result","geolocation","getCurrentPosition","err","message","reset","results","searchType","render","_this4","_this$state","selectSearchComponent","react__WEBPACK_IMPORTED_MODULE_3___default","a","createElement","style","height","display","flexDirection","_components_common__WEBPACK_IMPORTED_MODULE_11__","onClick","src","searchByRoute","margin","lineHeight","color","searchNearby","filterBy","tag","navigate","textAlign","boxSizing","width","cursor","opacity","transition","backgroundColor","colors","orange","_components_seo__WEBPACK_IMPORTED_MODULE_6__","title","_components_header__WEBPACK_IMPORTED_MODULE_7__","searchProps","bind","siteTitle","_components_search__WEBPACK_IMPORTED_MODULE_8__","miniature","React","Component","module","exports","__webpack_require__","p"],"mappings":"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","file":"component---src-pages-index-js-888c170a82b3ede0229f.js","sourcesContent":["import React from \"react\"\nimport { navigate } from \"gatsby\"\nimport { uniq, uniqBy } from \"lodash\"\n\nimport SEO from \"../components/seo\"\nimport HeaderComponent from \"../components/header\"\nimport Search from \"../components/search\"\n\nimport searchByRoute from \"../images/search-by-route.jpg\"\nimport searchNearby from \"../images/search-nearby.jpg\"\n\nimport {\n  Box,\n  Header,\n  SearchBoxes,\n  SearchBox,\n  Image,\n} from \"../components/common\"\n\nimport { parseRow, reverseGeocode } from \"../lib/helpers\"\n\nimport colors from \"../lib/colors\"\n\nconst DATA_URL =\n  \"https://docs.google.com/spreadsheets/d/e/2PACX-1vSba72Al-RA3rUkBruesaJpLe8A5pIm-EJ8ZvY5SeSIzJWi8sebSnNqBTckypxCCyEhk2UaWvD_6Kfe/pub?output=csv\"\n\nconst MY_LOCATION_TEXT = \"My Location - \"\n\nconst REVOKE_GEOLOCATION_PERMISSION = false\n\nexport default class IndexPage extends React.Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      autocompleteOptions: [],\n      autocompleteResults: [],\n      dataLoaded: false,\n      locations: [],\n      // searchType: \"route\",\n    }\n  }\n\n  componentDidMount() {\n    this.requestLocation()\n\n    window.scrollTo(0, 1)\n\n    if (REVOKE_GEOLOCATION_PERMISSION) {\n      navigator.permissions.revoke({ name: \"geolocation\" })\n    }\n\n    window.locations ? this.setData(window.locations) : this.loadData()\n  }\n\n  loadData() {\n    fetch(DATA_URL)\n      .then(res => res.text())\n      .then(rows => {\n        const locations = uniqBy(\n          rows\n            .split(\"\\n\")\n            .slice(1)\n            .map(parseRow)\n            .filter(r => r),\n          l => `${l.name} ${l.latitude} ${l.longitude}`\n        )\n        window.locations = locations\n        this.setData(locations)\n      })\n  }\n\n  setData(locations) {\n    console.log(`Data loaded: ${locations.length} locations.`)\n\n    const autocompleteOptions = uniq(\n      locations.map(l => `${l.city}, ${l.state}`)\n    )\n\n    this.setState({\n      locations,\n      autocompleteOptions,\n      dataLoaded: true,\n    })\n  }\n\n  requestLocation() {\n    // https://developer.mozilla.org/en-US/docs/Web/API/Permissions_API/Using_the_Permissions_API\n    if (!navigator) return\n    const permissions = navigator.permissions !== undefined\n    const options = { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }\n\n    const handlePosition = position => {\n      if (!position || !position.coords) return\n      const { latitude, longitude } = position.coords\n      // https://developers.google.com/maps/documentation/javascript/examples/geocoding-reverse\n      reverseGeocode(`${latitude},${longitude}`, address => {\n        if (!address || this.state.locationA) return\n        this.setState({ myLocation: `${MY_LOCATION_TEXT}${address}` })\n      })\n    }\n\n    if (permissions) {\n      navigator.permissions.query({ name: \"geolocation\" }).then(result => {\n        // granted / prompt / denied\n        if (result.state === \"denied\") return\n\n        navigator.geolocation.getCurrentPosition(\n          handlePosition,\n          err => console.log(`ERR: ${err.message}`),\n          options\n        )\n      })\n    } else {\n      navigator.geolocation.getCurrentPosition(\n        handlePosition,\n        err => console.log(`ERR: ${err.message}`),\n        options\n      )\n    }\n  }\n\n  reset() {\n    this.setState({\n      autocompleteResults: [],\n      results: undefined,\n      searchType: undefined,\n    })\n  }\n\n  render() {\n    const {\n      autocompleteOptions,\n      dataLoaded,\n      locations,\n      myLocation,\n      searchType,\n    } = this.state\n\n    const selectSearchComponent = (\n      <div\n        style={{\n          height: \"calc(100vh - 60px)\",\n          display: \"flex\",\n          flexDirection: \"column\",\n        }}\n      >\n        <SearchBoxes>\n          <SearchBox onClick={() => this.setState({ searchType: \"route\" })}>\n            <Image src={searchByRoute} />\n\n            <Header style={{ margin: 0, lineHeight: \"40px\" }} color={\"white\"}>\n              search by route\n            </Header>\n          </SearchBox>\n\n          <SearchBox\n            onClick={() => this.setState({ searchType: \"destination\" })}\n          >\n            <Image src={searchNearby} />\n\n            <Header style={{ margin: 0, lineHeight: \"40px\" }} color={\"white\"}>\n              search by location\n            </Header>\n          </SearchBox>\n        </SearchBoxes>\n\n        <Header\n          onClick={() => {\n            if (!locations.length) return\n            const filterBy = {\n              state: undefined,\n              city: undefined,\n              tag: undefined,\n            }\n            navigate(\"/results\", {\n              state: { results: [], locations, filterBy },\n            })\n          }}\n          style={{\n            textAlign: \"center\",\n            lineHeight: \"60px\",\n            boxSizing: \"border-box\",\n            width: \"100%\",\n            cursor: \"pointer\",\n            color: \"white\",\n            margin: 0,\n            opacity: dataLoaded ? 1 : 0,\n            transition: \"opacity 0.5s\",\n          }}\n        >\n          VIEW ALL\n        </Header>\n      </div>\n    )\n\n    return (\n      <Box style={{ backgroundColor: searchType ? \"white\" : colors.orange }}>\n        <SEO title=\"Home\" />\n\n        <HeaderComponent\n          searchProps={{}}\n          reset={this.reset.bind(this)}\n          siteTitle=\"Tour Food\"\n        />\n\n        {searchType ? (\n          <Search\n            autocompleteOptions={autocompleteOptions}\n            locations={locations}\n            miniature={false}\n            myLocation={myLocation}\n            searchType={searchType}\n          />\n        ) : (\n          selectSearchComponent\n        )}\n      </Box>\n    )\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/search-by-route-0d45664a9f2e6d650d2b60208872e728.jpg\";","module.exports = __webpack_public_path__ + \"static/search-nearby-c11fabd696436a266b4063971ea6cfad.jpg\";"],"sourceRoot":""}