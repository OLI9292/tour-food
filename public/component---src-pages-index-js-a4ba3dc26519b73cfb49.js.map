{"version":3,"sources":["webpack:///./src/pages/index.js","webpack:///./src/images/backgrounds/about.png","webpack:///./src/images/backgrounds/contact.png","webpack:///./src/images/backgrounds/faq.png","webpack:///./src/images/search-by-route.png","webpack:///./src/images/search-nearby.png","webpack:///./src/images/backgrounds sync ^\\.\\/.*\\.png$","webpack:///./src/images/backgrounds/destination.png","webpack:///./src/images/backgrounds/route.png"],"names":["searchByRoute","require","searchNearby","IndexPage","props","state","autocompleteOptions","autocompleteResults","dataLoaded","locations","isLoading","componentDidMount","window","locationResults","undefined","searchProps","this","requestLocation","setState","setData","loadData","fetch","then","res","text","rows","uniqBy","split","slice","map","parseRow","filter","r","l","name","latitude","longitude","console","log","length","uniq","city","navigator","hasPermissions","permissions","options","enableHighAccuracy","timeout","maximumAge","handlePosition","position","coords","reverseGeocode","address","locationA","myLocation","myLocationCoordinates","getPostion","geolocation","getCurrentPosition","err","message","query","reset","results","searchType","render","selectSearchComponent","onClick","src","style","margin","lineHeight","color","filterBy","tag","navigate","textAlign","boxSizing","width","cursor","opacity","transition","height","top","left","backgroundColor","colors","orange","backgroundImage","backgroundPositionY","title","bind","siteTitle","miniature","React","Component","module","exports","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve"],"mappings":"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","file":"component---src-pages-index-js-a4ba3dc26519b73cfb49.js","sourcesContent":["import React from \"react\"\nimport { navigate } from \"gatsby\"\nimport { uniq, uniqBy } from \"lodash\"\n\nimport SEO from \"../components/seo\"\nimport HeaderComponent from \"../components/header\"\nimport Search from \"../components/search\"\n\nimport {\n  Box,\n  Header,\n  SelectSearchBox,\n  SearchBoxes,\n  SearchBox,\n  Image,\n} from \"../components/common\"\n\nimport { parseRow, reverseGeocode } from \"../lib/helpers\"\n\nimport colors from \"../lib/colors\"\n\nconst searchByRoute = require(`../images/search-by-route.png`)\n\nconst searchNearby = require(`../images/search-nearby.png`)\n\nconst DATA_URL =\n  \"https://docs.google.com/spreadsheets/d/e/2PACX-1vSba72Al-RA3rUkBruesaJpLe8A5pIm-EJ8ZvY5SeSIzJWi8sebSnNqBTckypxCCyEhk2UaWvD_6Kfe/pub?output=csv\"\n\nconst MY_LOCATION_TEXT = \"My Location - \"\n\nconst REVOKE_GEOLOCATION_PERMISSION = false\n\nexport default class IndexPage extends React.Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      autocompleteOptions: [],\n      autocompleteResults: [],\n      dataLoaded: false,\n      locations: [],\n      isLoading: true,\n      // searchType: \"route\",\n    }\n  }\n\n  componentDidMount() {\n    window.locationResults = undefined\n    window.searchProps = undefined\n\n    this.requestLocation()\n    this.setState({ isLoading: false })\n\n    if (REVOKE_GEOLOCATION_PERMISSION) {\n      navigator.permissions.revoke({ name: \"geolocation\" })\n    }\n\n    window.locations ? this.setData(window.locations) : this.loadData()\n  }\n\n  loadData() {\n    fetch(DATA_URL)\n      .then(res => res.text())\n      .then(rows => {\n        const locations = uniqBy(\n          rows\n            .split(\"\\n\")\n            .slice(1)\n            .map(parseRow)\n            .filter(r => r),\n          l => `${l.name} ${l.latitude} ${l.longitude}`\n        )\n        window.locations = locations\n        this.setData(locations)\n      })\n  }\n\n  setData(locations) {\n    console.log(`Data loaded: ${locations.length} locations.`)\n\n    const autocompleteOptions = uniq(\n      locations.map(l => `${l.city}, ${l.state}`)\n    )\n\n    this.setState({\n      locations,\n      autocompleteOptions,\n      dataLoaded: true,\n    })\n  }\n\n  requestLocation() {\n    // https://developer.mozilla.org/en-US/docs/Web/API/Permissions_API/Using_the_Permissions_API\n    if (!navigator) return console.log(\"Navigator is undefined\")\n\n    const hasPermissions = navigator.permissions !== undefined\n    console.log(`Has permissions: ${hasPermissions}`)\n    const options = { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }\n\n    const handlePosition = position => {\n      if (!position || !position.coords) return\n      const { latitude, longitude } = position.coords\n      console.log(`Position: ${latitude}, ${longitude}`)\n      // https://developers.google.com/maps/documentation/javascript/examples/geocoding-reverse\n      reverseGeocode(`${latitude},${longitude}`, address => {\n        if (!address || this.state.locationA) return\n        this.setState({\n          myLocation: `${MY_LOCATION_TEXT}${address}`,\n          myLocationCoordinates: [latitude, longitude],\n        })\n      })\n    }\n\n    const getPostion = () => {\n      console.log(\"Getting position\")\n      navigator.geolocation.getCurrentPosition(\n        handlePosition,\n        err => console.log(`ERR: ${err.message}`),\n        options\n      )\n    }\n\n    hasPermissions\n      ? navigator.permissions.query({ name: \"geolocation\" }).then(res => {\n          if (res.state !== \"denied\") getPostion()\n        })\n      : getPostion()\n  }\n\n  reset() {\n    this.setState({\n      autocompleteResults: [],\n      results: undefined,\n      searchType: undefined,\n    })\n  }\n\n  render() {\n    const {\n      autocompleteOptions,\n      dataLoaded,\n      locations,\n      myLocation,\n      myLocationCoordinates,\n      searchType,\n    } = this.state\n\n    const selectSearchComponent = (\n      <SelectSearchBox>\n        <SearchBoxes>\n          <SearchBox onClick={() => this.setState({ searchType: \"route\" })}>\n            <Image src={searchByRoute} />\n\n            <Header style={{ margin: 0, lineHeight: \"40px\" }} color={\"white\"}>\n              search by route\n            </Header>\n          </SearchBox>\n\n          <SearchBox\n            onClick={() => this.setState({ searchType: \"destination\" })}\n          >\n            <Image src={searchNearby} />\n\n            <Header style={{ margin: 0, lineHeight: \"40px\" }} color={\"white\"}>\n              search by location\n            </Header>\n          </SearchBox>\n        </SearchBoxes>\n\n        <Header\n          onClick={() => {\n            if (!locations.length) return\n            const filterBy = {\n              state: undefined,\n              city: undefined,\n              tag: undefined,\n            }\n            navigate(\"/results\", {\n              state: { results: [], locations, filterBy },\n            })\n          }}\n          style={{\n            textAlign: \"center\",\n            lineHeight: \"60px\",\n            boxSizing: \"border-box\",\n            width: \"100%\",\n            cursor: \"pointer\",\n            color: \"white\",\n            margin: 0,\n            opacity: dataLoaded ? 1 : 0,\n            transition: \"opacity 0.5s\",\n          }}\n        >\n          VIEW ALL\n        </Header>\n      </SelectSearchBox>\n    )\n\n    if (this.state.isLoading) {\n      return (\n        <div\n          style={{\n            width: \"100vw\",\n            height: \"100vh\",\n            position: \"fixed\",\n            top: 0,\n            left: 0,\n            backgroundColor: colors.orange,\n          }}\n        />\n      )\n    }\n\n    const backgroundImage = searchType\n      ? `url(${require(`../images/backgrounds/${searchType}.png`)})`\n      : undefined\n\n    return (\n      <Box\n        style={{\n          backgroundColor: searchType ? \"white\" : colors.orange,\n          backgroundImage,\n          backgroundPositionY: \"100%\",\n        }}\n      >\n        <SEO title=\"Home\" />\n\n        <HeaderComponent\n          searchProps={{}}\n          reset={this.reset.bind(this)}\n          siteTitle=\"Tour Food\"\n        />\n\n        {searchType ? (\n          <Search\n            autocompleteOptions={autocompleteOptions}\n            locations={locations}\n            miniature={false}\n            myLocation={myLocation}\n            myLocationCoordinates={myLocationCoordinates}\n            searchType={searchType}\n          />\n        ) : (\n          selectSearchComponent\n        )}\n      </Box>\n    )\n  }\n}\n","module.exports = __webpack_public_path__ + \"static/about-6e08b9ea9ea8f048d2a66e08e78f153c.png\";","module.exports = __webpack_public_path__ + \"static/contact-b34ca2d8bff9abc5a762bbae92e07fbf.png\";","module.exports = __webpack_public_path__ + \"static/faq-7876d0d96155aeac5636dca2c595b39d.png\";","module.exports = __webpack_public_path__ + \"static/search-by-route-b06728f0c61d271df5962decc1f415c1.png\";","module.exports = __webpack_public_path__ + \"static/search-nearby-ba5444a805504845e5185b5e9fcfac14.png\";","var map = {\n\t\"./about.png\": 295,\n\t\"./contact.png\": 296,\n\t\"./destination.png\": 309,\n\t\"./faq.png\": 297,\n\t\"./route.png\": 310\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 308;","module.exports = __webpack_public_path__ + \"static/destination-c00c844e5d0680ebc1900c8fdf98cedc.png\";","module.exports = __webpack_public_path__ + \"static/route-0f57d1890d8c046a73a2a2ac5f34cb22.png\";"],"sourceRoot":""}